source('~/my_repos/mprsq/sleuth_all_adjusted/diff_exp_analyzer.R', echo=TRUE)
source('~/my_repos/mprsq/sleuth_all_adjusted/diff_exp_analyzer.R', echo=TRUE)
#point to your directory
base_dir <- 'kallisto'
#get ids
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
base_dir <- 'kallisto'
#get ids
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
clear
restart
refresh
rm()
rm('all')
rm(list =ls)
rm(list =ls())
library("sleuth")
library("optparse")
library("files")
#gene info for sleuth
print("Fetching bioMart info:")
mart <- biomaRt::useMart(biomart = "ensembl", dataset = "celegans_gene_ensembl")
t2g <- biomaRt::getBM(attributes = c("ensembl_transcript_id", "ensembl_gene_id",
"external_gene_name"), mart = mart)
print('#renaming genes:')
t2g <- dplyr::rename(t2g, target_id = ensembl_transcript_id,
ens_gene = ensembl_gene_id, ext_gene = external_gene_name)
#point to your directory
base_dir <- 'kallisto'
#get ids
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
getcwd()
gwd()
cwd()
getwd()
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
file.path(base_dir, "rna_seq_info.txt")
#get ids
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
sample_id <- dir(file.path(base_dir, "results"))
print(sample_id)
kal_dirs <- sapply(sample_id, function(id) file.path(base_dir, "results", id, "kallisto"))
print(kal_dirs)
s2c <- read.table(file.path(base_dir, "rna_seq_info.txt"), header = TRUE, stringsAsFactors= FALSE)
print(s2c)
s2c <- dplyr::select(s2c, sample= experiment, genotype, batch)
s2c <- dplyr::mutate(s2c, path = kal_dirs)
s2c
so <- sleuth_prep(s2c, ~ genotype+batch, target_mapping= t2g)
so <- sleuth_fit(so,~ genotype+batch, fit_name = 'full')
so <- sleuth_fit(so, ~batch, 'reduced')
so <- sleuth_lrt(so, 'reduced', 'full')
so <- sleuth_wt(so, which_beta = genovar, which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bB', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bA', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bC', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bD', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bE', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bF', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'bG', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebB', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebA', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebC', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebD', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebE', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebF', which_model = 'full')
so <- sleuth_wt(so, which_beta = 'genotypebG', which_model = 'full')
sleuth_live(so)
results_table <- sleuth_results(so, 'genotypebB', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasB.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebA', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasA.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebC', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasC.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebD', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasD.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebE', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasE.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebF', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasF.csv', sep='/'))
results_table <- sleuth_results(so, 'genotypebG', 'full', test_type= 'wt')
write.csv(results_table, paste(base_dir, 'betasG.csv', sep='/'))
